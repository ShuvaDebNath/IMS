<div class="card">
  <div class="card-header">
    <h3 class="card-title mb-0">
      <strong>Delivery</strong>
    </h3>
  </div>
  <div class="card-body">
    <form [formGroup]="SearchFormgroup">
      <fieldset class="border p-3">
        <legend class="w-auto px-2">Search</legend>
        <div class="row">
          <div class="col-auto">
            <label>PI Type</label>
            <p-dropdown
              formControlName="PIType"
              (onChange)="onChange($event)"
              [options]="PITypeList"
              [showClear]="true"
              optionLabel="text"
              optionValue="value"
              [style]="{ width: '100%' }"
              placeholder="Select a type"
            />
          </div>

          <div class="col-auto">
            <label>PI No</label>
            <p-dropdown
              [style]="{ width: '100%' }"
              class="p-0"
              [options]="PIList"
              optionLabel="PINo"
              [filter]="true"
              filterBy="PINo"
              [showClear]="true"
              styleClass="listBottom"
              placeholder="Please Select"
              optionValue="PI_Master_ID"
              formControlName="PIId"
              appendTo="body"
            >
              <ng-template let-PIList pTemplate="item">
                <div class="flex align-items-center gap-2">
                  <div>{{ PIList.PINo }}</div>
                </div>
              </ng-template>
            </p-dropdown>
          </div>

          <div class="col-auto mt-auto mb-2">
            <button
              title="Search"
              type="button"
              (click)="GetPIByPID()"
              class="btn btn-sm btn-outline-primary bg-gradient-primary"
            >
              <i class="fas fa-search"></i>&nbsp;Search
            </button>
          </div>

          <div class="col-auto mt-auto mb-2">
            <button
            [disabled]="Formgroup.invalid"
              title="Deliver"
              type="button"
              (click)="Save()"
              class="btn btn-sm btn-outline-success bg-gradient-success"
            >
              <i class="fas fa-check"></i>&nbsp;Deliver
            </button>
          </div>
        </div>
      </fieldset>
    </form>

    <p-divider />
    <form [formGroup]="Formgroup" role="form">
      <div class="row delivery-header-row">
        <input type="hidden" pInputText formControlName="PIStatus" class="min-w-140" />

        <div class="col-auto">
          <label class="mr-1">Challan No</label>
          <input type="text" readonly="true" pInputText formControlName="Chalan_No" class="min-w-140" />
        </div>

        <div class="col-auto">
          <label class="mr-1">Deliverable</label>
          <p-inputNumber  [readonly]="true" formControlName="RestQty" class="min-w-140"></p-inputNumber>
        </div>

        <div class="col-auto">
          <label class="mr-2">LC No</label>
          <input type="text" readonly="true" pInputText formControlName="LCNo" class="min-w-140" />
        </div>

        <div class="col-auto">
          <label class="mr-2">Cash Status</label>
          <input type="text" readonly="true" pInputText formControlName="IsCash" class="min-w-220" />
        </div>
      </div>

      <div class="mt-2">
        <p-table
          [value]="getControls()"
          [tableStyle]="{ 'min-width': '100rem' }"
          styleClass="p-datatable-gridlines p-datatable-striped"
        >
          <ng-template pTemplate="header">
            <tr>
              <th>Description</th>
              <th>Color</th>
              <th>Packaging</th>
              <th>Width</th>
              <th>Actual Article No.</th>
              <th>Stock</th>
              <th>Roll</th>
              <th>Undelivered Quantity</th>
              <th>Unit</th>
              <th>Deliver Quantity</th>
              <th>Roll/BOX/PCS</th>
              <th>Remark</th>
              <th>Stock Location</th>
            </tr>
          </ng-template>
          <ng-template
            *ngIf="Formgroup.controls.ItemArray != null"
            pTemplate="body"
            let-item
          >
            <tr [formGroup]="item">
              <td>{{ item.value.Description }}</td>
              <td>{{ item.value.Color }}</td>
              <td>{{ item.value.Packaging }}</td>
              <td>{{ item.value.Measurement }}</td>
              <td>{{ item.value.ActualArticle }}</td>
              <td>{{ item.value.Stock }}</td>
              <td>{{ item.value.RollBalance }}</td>
              <td>{{ item.value.UndeliveredQty }}</td>
              <td>{{ item.value.UnitName }}</td>
              <td>
                <p-inputNumber
                  placeholder="Deliver Quantity"
                  formControlName="Delivered"
                  (keyup)="SetMeterValue($event, item)"
                />
              </td>
              <td>
                <p-inputNumber
                  placeholder="Roll/BOX/PCS"
                  formControlName="Roll"
                />
              </td>
              <td>
                <input
                  type="text"
                  pInputText
                  placeholder="Remark"
                  formControlName="Remark"
                />
              </td>
              <td>
                <p-dropdown
                  [style]="{ width: '100%' }"
                  class="p-0"
                  [options]="StoreLocation"
                  optionLabel="Stock_Location_Name"
                  [filter]="true"
                  filterBy="Stock_Location_Name"
                  [showClear]="true"
                  styleClass="listBottom"
                  placeholder="Please Select"
                  optionValue="Stock_Location_ID"
                  formControlName="Stock_Location_ID"
                  appendTo="body"
                >
                  <ng-template let-RequestStatus pTemplate="item">
                    <div class="flex align-items-center gap-2">
                      <div>{{ RequestStatus.Stock_Location_Name }}</div>
                    </div>
                  </ng-template>
                </p-dropdown>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </form>
  </div>
  <div class="card-footer"></div>
</div>
