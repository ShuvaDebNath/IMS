
<div class="card m-2 p-2">
  <!-- Card Header -->
  <div class=" theme-bg d-flex justify-content-between align-items-center sticky-header">
    <h3 class="card-title mb-0">
      <strong>{{ PageTitle }}</strong>
    </h3>
    <div class="btn-group" role="group">
  <button *ngIf="ShowbtnPar" (click)="getSelectedRows('Partial Approved')" type="button"
    class="btn btn-outline-light btn-sm">
    <i class="fas fa-check"></i>&nbsp;Partial Approve
  </button>
  <button *ngIf="ShowbtnQar" (click)="getSelectedRows('Quartar Approved')" type="button"
    class="btn btn-outline-info btn-sm">
    <i class="fas fa-check"></i>&nbsp;Quarterly Approve
  </button>
  <button *ngIf="ShowbtnFull" (click)="getSelectedRows('Full Approved')" type="button"
    class="btn btn-outline-warning btn-sm">
    <i class="fas fa-check"></i>&nbsp;Full Approve
  </button>
  <button *ngIf="ShowbtnRej" (click)="getSelectedRows('Rejected')" type="button"
    class="btn btn-outline-danger btn-sm">
    <i class="fas fa-times"></i>&nbsp;Reject
  </button>
</div>
  </div>

  <!-- Card Body -->
  <div class="card-body">
    <!-- Search Form -->
    <form id="Search" [formGroup]="SearchFormgroup" forle="form">
      <fieldset class="border p-3 rounded">
        <legend class="w-auto px-2">üîç Search</legend>

        <div class="row">
          <div class="col-md-3 mb-3">
            <label>Cash or LC</label>
            <p-dropdown formControlName="PIType" [options]="PITypeList" [showClear]="true" optionLabel="text"
              optionValue="value" styleClass="w-100" placeholder="Select type">
            </p-dropdown>
          </div>

          <div class="col-md-3 mb-3">
            <label>From Date</label>
            <input type="text" class="form-control form-control-sm" placeholder="From Date" autocomplete="off"
              formControlName="FromDate" #dpfrom="bsDatepicker" bsDatepicker
              [bsConfig]="{ dateInputFormat: 'DD/MM/YYYY', containerClass: 'theme-green' }" />
          </div>

          <div class="col-md-3 mb-3">
            <label>To Date</label>
            <input type="text" class="form-control form-control-sm" placeholder="To Date" autocomplete="off"
              formControlName="ToDate" #dpto="bsDatepicker" bsDatepicker
              [bsConfig]="{ dateInputFormat: 'DD/MM/YYYY', containerClass: 'theme-green' }" />
          </div>

          <div class="col-md-3 mb-3">
            <label>PI No</label>
            <input type="text" formControlName="PINo" class="form-control form-control-sm" placeholder="PI No" />
          </div>

          <div class="col-md-3 mb-3">
            <label>Shipper</label>
            <input type="text" formControlName="Shipper" class="form-control form-control-sm" placeholder="Shipper" />
          </div>

          <div class="col-md-3 mb-3">
            <label>Consignee</label>
            <input type="text" formControlName="Consignee" class="form-control form-control-sm"
              placeholder="Consignee" />
          </div>

          <div class="col-md-3 mb-3">
            <label>Generated By</label>
            <input type="text" formControlName="CreateBY" class="form-control form-control-sm"
              placeholder="Generated By" />
          </div>

          <div class="col-md-3 d-flex align-items-end mb-3">
            <button type="button" (click)="LoadTableData()" class="btn theme-btn btn-sm btn-primary w-100">
              <i class="fas fa-search"></i>&nbsp;Search
            </button>
          </div>
        </div>
      </fieldset>
    </form>

    <!-- Table -->
    <p-divider />

    <p-table #table [value]="DataTable" [paginator]="DataTable.length>0" [rows]="10" [lazy]="true"
      [totalRecords]="totalRecords" [showCurrentPageReport]="DataTable.length>0" [(selection)]="selectedRows"
      dataKey="PI_Master_ID" (onLazyLoad)="ReloadTable($event)" [rowsPerPageOptions]="[10,20,50,100,totalRecords]"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries">

      <!-- Table Header -->
      <ng-template pTemplate="header">
        <tr>
          <th *ngIf="PiStatus!='Full Approved'" style="width: 3rem"><p-tableHeaderCheckbox /></th>
          <th style="text-align: center;">#</th>
          <th pSortableColumn="PINo">PI No <p-sortIcon field="PINo"></p-sortIcon></th>
          <th pSortableColumn="PIDate">Date <p-sortIcon field="PIDate"></p-sortIcon></th>
          <th pSortableColumn="BeneficiaryCompanyName">Shipper <p-sortIcon field="BeneficiaryCompanyName"></p-sortIcon>
          </th>
          <th pSortableColumn="CustomerName">Consignee <p-sortIcon field="CustomerName"></p-sortIcon></th>
          <th pSortableColumn="CreatedByUserName">Generated By <p-sortIcon field="CreatedByUserName"></p-sortIcon></th>
          <th style="text-align: center;">Action</th>
        </tr>
      </ng-template>

      <!-- Table Body -->
      <ng-template pTemplate="body" let-row let-i="rowIndex">
        <tr>
          <td *ngIf="PiStatus!='Full Approved'">
            <p-tableCheckbox [value]="row" />
          </td>
          <td style="text-align: center;">{{ i + 1 }}</td>
          <td>{{ row.PINo }}</td>
          <td>{{ row.PIDate | date:'dd-MM-yyyy' }}</td>
          <td>{{ row.BeneficiaryCompanyName }}</td>
          <td>{{ row.CustomerName }}</td>
          <td>{{ row.CreatedByUserName }}</td>
          <td class="text-center">
            <p-button icon="pi pi-eye" styleClass="theme-btn p-button-info p-button-sm mr-2"
              (onClick)="ViewDetails(row.PI_Master_ID)" pTooltip="View Details" tooltipPosition="bottom">
            </p-button>
            <p-button *ngIf="ShowbtnSpecial" icon="pi pi-check"
              styleClass="p-button-rounded p-button-success p-button-sm"
              (onClick)="OpenSpecialApprove(row.PI_Master_ID)" pTooltip="Special Approval" tooltipPosition="bottom">
            </p-button>
          </td>
        </tr>
      </ng-template>

      <!-- Empty Message -->
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="8" class="text-center text-muted py-3">
            <i class="pi pi-info-circle"></i> No data found
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>

<p-dialog header="Details" [(visible)]="isViewDetails" [modal]="true" [closable]="true"
  [style]="{ width: '90vw', maxWidth: '1200px' }"
  [breakpoints]="{ '1199px': '80vw', '768px': '95vw' }"
  [contentStyle]="{ 'max-height': 'calc(100vh - 150px)', 'overflow': 'auto' }"
  [maximizable]="true" (onHide)="isViewDetails = false" styleClass="wide-dialog">

  <div class="card">
    <!-- Header -->
    <div class="card-header d-flex justify-content-between align-items-center sticky-header p-2">
      <div>
        <h5 class="mb-0">{{ PIData?.PINo }}</h5>
        <small class="text-muted">{{ PIData?.PIDate | date:'dd/MM/yyyy HH:mm:ss' }}</small>
      </div>

      <div class="btn-group">
        <p-button label="PI Log" icon="pi pi-history" styleClass="p-button-info p-button-sm mr-2"></p-button>
        <p-button label="PI Detail Log" icon="pi pi-list" styleClass="p-button-info p-button-sm mr-2"></p-button>
        <p-button label="Excel" icon="pi pi-file-excel" styleClass="p-button-success p-button-sm mr-2"></p-button>
        <p-button label="PDF" icon="pi pi-file-pdf" styleClass="p-button-danger p-button-sm mr-2"></p-button>
        <p-button label="Delivery" icon="pi pi-truck" styleClass="p-button-warning p-button-sm"></p-button>
      </div>
    </div>

    <!-- Body -->
    <div class="card-body">
      <!-- Master Info -->
      <div class="row">
        <div class="col-md-6">
          <div class="info-group">
            <label>Consignee Initial</label><span>{{ PIData?.Consignee_Initial }}</span>
            <label>Shipper</label><span>{{ PIData?.BeneficiaryCompanyName }}</span>
            <label>Beneficiary Bank</label><span>{{ PIData?.BeneficiaryBankName }}</span>
            <label>Consignee</label><span>{{ PIData?.CustomerName }}</span>
            <label>Applicant Bank</label><span>{{ PIData?.CustomerBankName }}</span>
            <label>Buyer Name</label><span>{{ PIData?.BuyerName }}</span>
            <label>Country Of Origin</label><span>{{ PIData?.CountryOfOriginName }}</span>
            <label>Delivery Details</label><span>{{ PIData?.Delivery }}</span>
            <label>Terms of Delivery</label><span>{{ PIData?.TermsOfDeliveryName }}</span>
            <label>Force Majeure</label><span>{{ PIData?.ForceMajeureName }}</span>
            <label>Loading Mode</label><span>{{ PIData?.LoadingModeName }}</span>
            <label>Contact Person</label><span>{{ PIData?.Contact_Person }}</span>
            <label>Packing Mode</label><span>{{ PIData?.PackingName }}</span>
            <label>Expire Date</label><span>{{ PIData?.ExpireDate | date:'dd/MM/yyyy HH:mm:ss' }}</span>
          </div>
        </div>

        <div class="col-md-6">
          <div class="info-group">
            <label>Arbitration</label><span>{{ PIData?.ArbitrationName }}</span>
            <label>Remarks</label><span>{{ PIData?.Remarks }}</span>
            <label>Style</label><span>{{ PIData?.Style }}</span>
            <label>Payment Terms</label><span>{{ PIData?.PaymentTermName }}</span>
            <label>Price Term</label><span>{{ PIData?.PriceTermName }}</span>
            <label>Partial Shipment</label><span>{{ PIData?.ShipmentName }}</span>
            <label>Delivery Address</label><span>{{ PIData?.Delivery_Address }}</span>
            <label>Documents</label><span>{{ PIData?.Documents }}</span>
            <label>Goods Description</label><span>{{ PIData?.GoodsDescription }}</span>
            <label>Shipping Marks</label><span>{{ PIData?.ShippingMarks }}</span>
            <label>Loading Port</label><span>{{ PIData?.Loading_Port }}</span>
            <label>Destination Port</label><span>{{ PIData?.Destination_Port }}</span>
            <label>Created By</label><span>{{ PIData?.CreatedByUserName }}</span>
            <label>Superior</label><span>{{ PIData?.SuperiorName }}</span>
            <label>Status</label>
            <span><span class="badge bg-danger">{{ PIData?.Status | uppercase }}</span></span>
          </div>
        </div>
      </div>

      <p-divider></p-divider>

      <!-- Item Table -->
      <p-table [value]="PIDetails" [responsiveLayout]="'scroll'" styleClass="p-datatable-sm">
        <ng-template pTemplate="header">
          <tr>
            <th>Article</th>
            <th>A.A.</th>
            <th>Description</th>
            <th>Width</th>
            <th>Color</th>
            <th>Packaging</th>
            <th>Qty</th>
            <th>Unit</th>
            <th>Unit Price ({{ PIData?.IsMPI==false?'USD':'BDT' }})</th>
            <th>Total Amount ({{ PIData?.IsMPI==false?'USD':'BDT' }})</th>
            <th>Prod. Cost Unit</th>
            <th>Total Prod. Cost</th>
            <th>Delivered</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item>
          <tr>
            <td>{{ item.Article }}</td>
            <td>{{ item.ArticleNo_from_StaticInfo }}</td>
            <td>{{ item.Description }}</td>
            <td>{{ item.Width }}</td>
            <td>{{ item.Color }}</td>
            <td>{{ item.Packaging }}</td>
            <td>{{ item.Quantity }}</td>
            <td>{{ item.Unit }}</td>
            <td>{{ item.Unit_Price }}</td>
            <td>{{ PIData?.IsMPI==false ? item.Total_Amount : item.Total_Amount_Tk }}</td>
            <td>{{ item.CommissionUnit }}</td>
            <td>{{ item.TotalCommission }}</td>
            <td>{{ item.Delivered_Quantity }}</td>
          </tr>
        </ng-template>
      </p-table>
    </div>

    <!-- Footer -->
    <div class="card-footer p-2">
      <strong>{{ PIData?.AmountInWord }}</strong>
    </div>
  </div>
</p-dialog>