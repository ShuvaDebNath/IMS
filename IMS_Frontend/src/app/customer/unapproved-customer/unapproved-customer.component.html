<div class="container">
  <h1 class="theme-text">Unapproved Customers List</h1>

  <form
    [formGroup]="dateForm"
    class="row p-3 shadow-sm g-3 align-items-end mb-3"
    (ngSubmit)="loadAllCustomers()"
  >
    <div class="col-md-3" *ngIf="SuperiorList">
      <label>Superior Name <span>*</span></label>
      <p-dropdown
        [style]="{ width: '100%' }"
        class="p-0"
        [options]="SuperiorList"
        optionLabel="UserName"
        [filter]="true"
        filterBy="UserName"
        [showClear]="true"
        styleClass="listBottom"
        placeholder="Please Select"
        optionValue="User_ID"
        (onChange)="getCustomerList()"
        formControlName="SuperioId"
      >
        <ng-template let-AB pTemplate="item">
          <div class="flex align-items-center gap-2">
            <div>{{ AB.UserName }}</div>
          </div>
        </ng-template>
      </p-dropdown>
    </div>
    <div class="col-md-3">
      <label>Customer Name <span>*</span></label>
      <p-dropdown
        [style]="{ width: '100%' }"
        class="p-0"
        [options]="CustomerList"
        optionLabel="Company_Name"
        [filter]="true"
        filterBy="Company_Name"
        [showClear]="true"
        styleClass="listBottom"
        placeholder="Please Select"
        optionValue="Customer_ID"
        formControlName="CustomerId"
        [virtualScroll]="true"
        [virtualScrollItemSize]="30"
      >
        <ng-template let-AB pTemplate="item">
          <div class="flex align-items-center gap-2">
            <div>{{ AB.Company_Name }}</div>
          </div>
        </ng-template>
      </p-dropdown>
    </div>
    <div class="col-md-2">
      <button
        type="submit"
        class="btn btn-sm theme-btn w-100"
        [disabled]="dateForm.invalid"
      >
        <i class="pi pi-download me-1"></i> Load
      </button>
    </div>
    <div class="col-md-2">
      <div class="d-flex align-items-center">
        <button
          *ngIf="insertPermissions"
          class="btn theme-btn"
          style="color: white"
          routerLink="/generate-customers"
          target="_blank"
        >
          <i class="fas fa-plus"></i>&nbsp;Create New
        </button>
      </div>
    </div>
  </form>
  <div class="row mb-3" *ngIf="tableVisible">
    <div class="col-md-12">
      <button
        class="btn theme-btn px-4 py-2"
        (click)="printDialog()"
        title="Export Cash Receive list to Excel, Word, or PDF"
      >
        <i class="fas fa-download"></i>&nbsp; Export
      </button>
    </div>
  </div>
  <div class="shadow-sm p-2">
    <p-table
      *ngIf="tableVisible"
      #dt
      [value]="allCustomers"
      [paginator]="true"
      [rows]="10"
      [responsive]="true"
      [showCurrentPageReport]="true"
      [globalFilterFields]="[
        'Company_Name',
        'Contact_Name',
        'Customer_Address',
        'Contact_Title',
        'UserName',
        'Phone_No',
        'Email',
        'Created_By',
        'Created_At',
        'Status',
        'Updated_By',
        'Updated_At'
      ]"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
    >
      <ng-template pTemplate="caption">
        <div class="table-toolbar">
          <span class="p-input-icon-left">
            <i class="pi pi-search"></i>
            <input
              pInputText
              type="text"
              (input)="dt.filterGlobal($any($event.target).value, 'contains')"
              placeholder="Global Search"
            />
          </span>
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr>
          <th class="text-center">Serial No</th>
          <th class="text-center">Customer Name</th>
          <th class="text-center">Contact Person</th>
          <th class="text-center">Customer Address</th>
          <th class="text-center">Designation</th>
          <th class="text-center">Group Head</th>
          <th class="text-center">Phone Number</th>
          <th class="text-center">E-mail Address</th>
          <th class="text-center">Created By</th>
          <th class="text-center">Created Date</th>
          <th class="text-center">Status</th>
          <th class="text-center">Approved By</th>
          <th class="text-center">Approved Date</th>
          <th class="text-center">Action</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-CustomersLIst let-i="rowIndex">
        <tr>
          <td class="text-center">{{ (dt.first || 0) + i + 1 }}</td>
          <td class="text-start">{{ CustomersLIst.Company_Name }}</td>
          <td class="text-start">{{ CustomersLIst.Contact_Name }}</td>
          <td class="text-start">{{ CustomersLIst.Customer_Address }}</td>
          <td class="text-start">{{ CustomersLIst.Contact_Title }}</td>
          <td class="text-start">{{ CustomersLIst.UserName }}</td>
          <td class="text-start">{{ CustomersLIst.Phone_No }}</td>
          <td class="text-start">{{ CustomersLIst.Email }}</td>
          <td class="text-start">{{ CustomersLIst.CreatedBy }}</td>
          <td class="text-center">
            {{ CustomersLIst.Created_At | date : "dd-MMM-yyyy" }}
          </td>
          <td class="text-start">{{ CustomersLIst.Status }}</td>
          <td class="text-center">{{ CustomersLIst.ApprovedBy }}</td>
          <td class="text-center">
            {{ CustomersLIst.ApprovedDate | date : "dd-MMM-yyyy" }}
          </td>

          <td class="d-flex gap-2 justify-content-center">
            <button
              class="btn btn-success btn-sm d-inline-flex align-items-center"
              (click)="approeReq(CustomersLIst)"
              title="Approve"
              aria-label="Approve"
            >
              <i class="fas fa-check"></i>
            </button>
            <button
              class="btn btn-danger btn-sm d-inline-flex align-items-center"
              (click)="onDelete(CustomersLIst)"
              title="Delete"
              aria-label="Delete"
            >
              <i class="pi pi-trash me-1"></i>
            </button>
            <!-- âœ… call the handler that opens the dialog -->
            <button
              class="btn btn-info btn-sm text-white d-inline-flex align-items-center"
              (click)="onDetails(CustomersLIst)"
              title="Details"
              aria-label="Details"
            >
              <i class="pi pi-eye me-1"></i>
            </button>
          </td>
        </tr>
      </ng-template>
    </p-table>

    <!-- Details dialog -->
    <p-dialog
    header="Details"
    [(visible)]="isDetailsVisible"
    [modal]="true"
    [closable]="true"
    [style]="{ width: '50rem' }"
    [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
    [style]="{ width: '100vw', height: '100vh', top: '0', left: '0' }"
    [contentStyle]="{ height: 'calc(100vh - 100px)' }"
    [maximizable]="true"
    (onHide)="detailsData = null"
    styleClass="wide-dialog"
  >
    <form>
      <div class="card card-primary" *ngIf="detailsData">
        <div class="card-header m-0 p-2 sticky-header">
          <div class="float-left">
            <h5>Company Name - {{ detailsData.Company_Name }}</h5>
          </div>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <div class="row">
                <div class="col-md-4 mt-2 text-right content-middle">
                  <strong>Group head</strong>
                </div>
                <div class="col-md-8 mt-2">{{ detailsData.Group_head }}</div>

                <div class="col-md-4 mt-2 text-right content-middle">
                  <strong>Contact Person</strong>
                </div>
                <div class="col-md-8 mt-2">{{ detailsData.Contact_Name }}</div>

                <div class="col-md-4 mt-2 text-right content-middle">
                  <strong>Company Info</strong>
                </div>
                <div class="col-md-8 mt-2">{{ detailsData.company_info }}</div>

                <div class="col-md-4 mt-2 text-right content-middle">
                  <strong>Customer Address</strong>
                </div>
                <div class="col-md-8 mt-2">
                  {{ detailsData.Customer_Address }}
                </div>

                <div class="col-md-4 mt-2 text-right content-middle">
                  <strong>City</strong>
                </div>
                <div class="col-md-8 mt-2">{{ detailsData?.City }}</div>

                <div class="col-md-4 mt-2 text-right content-middle">
                  <strong>Postal Code</strong>
                </div>
                <div class="col-md-8 mt-2">{{ detailsData?.Postal_Code }}</div>

                <div class="col-md-4 mt-2 text-right content-middle">
                  <strong>Country</strong>
                </div>
                <div class="col-md-8 mt-2">{{ detailsData?.Country }}</div>

                <div class="col-md-4 mt-2 text-right content-middle">
                  <strong>Designation</strong>
                </div>
                <div class="col-md-8 mt-2">{{ detailsData?.Delivery }}</div>

                <div class="col-md-4 mt-2 text-right content-middle">
                  <strong>Terms of Delivery</strong>
                </div>
                <div class="col-md-8 mt-2">
                  {{ detailsData?.Contact_Title }}
                </div>

                <div class="col-md-4 mt-2 text-right content-middle">
                  <strong>Phone No</strong>
                </div>
                <div class="col-md-8 mt-2">{{ detailsData?.Phone_No }}</div>

                <div class="col-md-4 mt-2 text-right content-middle">
                  <strong>FAX No</strong>
                </div>
                <div class="col-md-8 mt-2">{{ detailsData?.FAX_No }}</div>

                <div class="col-md-4 mt-2 text-right content-middle">
                  <strong>Contact Person</strong>
                </div>
                <div class="col-md-8 mt-2">
                  {{ detailsData?.Contact_Person }}
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="row">
                <div class="col-md-4 mt-2 text-right content-middle">
                  <strong>Email</strong>
                </div>
                <div class="col-md-8 mt-2">{{ detailsData?.Email }}</div>

                <div class="col-md-4 mt-2 text-right content-middle">
                  <strong>Notes</strong>
                </div>
                <div class="col-md-8 mt-2">{{ detailsData?.Notes }}</div>

                <div class="col-md-4 mt-2 text-right content-middle">
                  <strong>Created By</strong>
                </div>
                <div class="col-md-8 mt-2">{{ detailsData?.CreatedBy }}</div>

                <div class="col-md-4 mt-2 text-right content-middle">
                  <strong>Created [style.property]="expression"</strong>
                </div>
                <div class="col-md-8 mt-2">
                  {{ detailsData?.Created_At | date : "dd-MMM-yyyy" }}
                </div>

                <div class="col-md-4 mt-2 text-right content-middle">
                  <strong>status</strong>
                </div>
                <div class="col-md-8 mt-2">{{ detailsData?.status }}</div>

                <div class="col-md-4 mt-2 text-right content-middle">
                  <strong>Approved By</strong>
                </div>
                <div class="col-md-8 mt-2">{{ detailsData?.ApprovedBy }}</div>

                <div class="col-md-4 mt-2 text-right content-middle">
                  <strong>Approved Date</strong>
                </div>
                <div class="col-md-8 mt-2">
                  {{ detailsData?.ApprovedDate | date : "dd-MMM-yyyy" }}
                </div>

                <div class="col-md-4 mt-2 text-right content-middle">
                  <strong>Updated By</strong>
                </div>
                <div class="col-md-8 mt-2">{{ detailsData?.UppdatedBy }}</div>

                <div class="col-md-4 mt-2 text-right content-middle">
                  <strong>Updated At</strong>
                </div>
                <div class="col-md-8 mt-2">
                  {{ detailsData.Updated_At | date : "dd-MMM-yyyy" }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </form>
  </p-dialog>
  </div>
</div>
