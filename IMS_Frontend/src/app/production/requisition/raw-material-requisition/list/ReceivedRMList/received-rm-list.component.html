<div class="container py-3">
  <div class="card shadow-sm border-0 mb-3">
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
      <h5 class="mb-0">
        <i class="pi pi-list mr-2"></i> Received RM List from Production
      </h5>
      <span class="p-input-icon-left">
        <i class="pi pi-search"></i>
        <input pInputText type="text" class="form-control" 
          (input)="dt.filterGlobal($any($event.target).value, 'contains')" 
          placeholder="Search records..." />
      </span>
    </div>

    <div class="card-body p-0">
      <p-table #dt [value]="acceptedRequisitions" [paginator]="true" [rows]="10"
        [showCurrentPageReport]="true"
        [globalFilterFields]="['RequisitionNumber','RequisitionDate','SentStatus_from_Warehouse','IssueNumber','IssueDate','ReceivedStatus_from_Production','SentBy']"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" 
        styleClass="p-datatable-sm p-datatable-gridlines">

        <ng-template pTemplate="header">
          <tr>
            <th class="text-center">#</th>
            <th>Issue Number</th>
            <th class="text-center">Issue Date</th>
            <th class="text-center">Status</th>
            <th class="text-center">Action</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-requisition let-i="rowIndex">
          <tr>
            <td class="text-center">{{ i + 1 }}</td>
            <td>{{ requisition.IssueNumber }}</td>
            <td class="text-center">{{ requisition.IssueDate }}</td>
            <td class="text-center">
              <span class="badge bg-success px-2 py-1">
                {{ requisition.ReceivedStatus_from_Production }}
              </span>
            </td>
            <td class="text-center">
              <button class="btn btn-sm btn-outline-primary" (click)="onDetails(requisition)" title="View Details">
                <i class="pi pi-eye"></i>
              </button>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="footer">
          <tr>
            <td colspan="5" class="text-end fw-bold">
              Total Issued: {{ acceptedRequisitions.length }}
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>

  <!-- Details dialog -->
  <p-dialog header="Requisition Details" [(visible)]="isDetailsVisible" [modal]="true" [closable]="true"
    [style]="{ width: '70vw' }" (onHide)="detailsData = null">
    <div *ngIf="detailsData" class="p-3">
      <div class="mb-3">
        <h6 class="fw-bold"><i class="pi pi-file mr-2"></i> Issue No: {{ detailsData.IssueNumber }}</h6>
        <p class="mb-1"><strong>Issue Date:</strong> {{ detailsData.IssueDate }}</p>
        <p class="mb-1"><strong>Requisition No:</strong> {{ detailsData.RequisitionNumber }}</p>
        <p class="mb-1"><strong>Requisition Date:</strong> {{ detailsData.RequisitionDate }}</p>
        <p><strong>Note:</strong> {{ detailsData.MasterNote }}</p>
      </div>

      <p-table [value]="detailsData.Items" styleClass="p-datatable-sm p-datatable-striped">
        <ng-template pTemplate="header">
          <tr>
            <th>Article</th>
            <th>Description</th>
            <th class="text-center">Sent Qty</th>
            <th class="text-center">Roll/Bag</th>
            <th class="text-center">Roll Qty</th>
            <th class="text-center">Bag Qty</th>
            <th class="text-center">Accepted Qty</th>
            <th class="text-center">Accepted Roll/Bag Qty</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item>
          <tr>
            <td>{{ item.ConcatArticleNo }}</td>
            <td>{{ item.DetaisNote }}</td>
            <td class="text-center">{{ item.Quantity }}</td>
            <td class="text-center">{{ item.Roll_Bag }}</td>
            <td class="text-center">{{ item.Roll }}</td>
            <td class="text-center">{{ item.Bag }}</td>
            <td class="text-center">{{ item.AcceptedQuantity }}</td>
            <td class="text-center">{{ item.AcceptedRollBag_Qty }}</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </p-dialog>
</div>
