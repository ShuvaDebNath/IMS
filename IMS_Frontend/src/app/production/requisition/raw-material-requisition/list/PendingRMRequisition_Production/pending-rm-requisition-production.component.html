<div class="m-2 p-2 shadow-sm">
  <div class="card">
    <div class="card-header theme-bg">
        <h1 class="">Pending RM Requisition List</h1>

    </div>
    <div class="card-body">

  <p-table class="theme-bg" #dt
           [value]="pendingRequisitions"
           [paginator]="true"
           [rows]="10"
           [responsive]="true"
           [showCurrentPageReport]="true"
           [globalFilterFields]="['RequisitionNumber','RequisitionDate','Total_Qty','Total_bag','Total_Roll','Status']"
           currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries">

    <ng-template pTemplate="caption">
      <div class="table-toolbar">
        <span class="p-input-icon-left">
          <i class="pi pi-search"></i>
          <input pInputText type="text"
                 (input)="dt.filterGlobal($any($event.target).value, 'contains')"
                 placeholder="Global Search" />
        </span>
      </div>
    </ng-template>

    <ng-template pTemplate="header">
      <tr>
        <th class="text-center">Serial No</th>
        <th class="text-center">Requisition No</th>
        <th class="text-center">Date</th>
        <th class="text-center">Total Qty</th>
        <th class="text-center">Total Bag</th>
        <th class="text-center">Total Roll</th>
        <th class="text-center">Status</th>
        <th class="text-center">Action</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-requisition let-i="rowIndex">
      <tr>
        <td class="text-center">{{ (dt.first || 0) + i + 1 }}</td>
        <td class="text-start">{{ requisition.RequisitionNumber }}</td>
        <td class="text-center">{{ requisition.RequisitionDate | date:'dd-MMM-yyyy' }}</td>
        <td class="text-center">{{ requisition.Total_Qty }}</td>
        <td class="text-center">{{ requisition.Total_bag }}</td>
        <td class="text-center">{{ requisition.Total_Roll }}</td>
        <td class="text-center">{{ requisition.Status }}</td>

        <td class="d-flex gap-2 justify-content-center">
          <button class="btn theme-btn-edit btn-sm d-inline-flex align-items-center" (click)="onEdit(requisition)" title="Edit" aria-label="Edit">
            <i class="pi pi-pencil me-1"></i>
          </button>
          <button class="btn theme-btn-delete btn-sm d-inline-flex align-items-center" (click)="onDelete(requisition)" title="Delete" aria-label="Delete">
            <i class="pi pi-trash me-1"></i>
          </button>
          <!-- âœ… call the handler that opens the dialog -->
          <button class="btn theme-btn-view btn-sm text-white d-inline-flex align-items-center"
                  (click)="onDetails(requisition)" title="Details" aria-label="Details">
            <i class="pi pi-eye me-1"></i>
          </button>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="footer">
      <tr>
        <td colspan="8">Total Pending: {{ pendingRequisitions.length }}</td>
      </tr>
    </ng-template>
  </p-table>

  <!-- Details dialog -->
  <p-dialog header="Detail"
            [(visible)]="isDetailsVisible"
            [modal]="true"
            [closable]="true"
            [style]="{ width: '70vw' }"
            (onHide)="detailsData = null">
    <hr>
      <div class="row mb-3" *ngIf="isDetailsVisible">
        <div class="col-md-12">
          <button
            class="btn theme-btn px-4 py-2"
            (click)="printDialog()"
            title="Export LC list to Excel, Word, or PDF"
          >
            <i class="fas fa-download"></i>&nbsp; Export
          </button>
        </div>
      </div>
    <div *ngIf="detailsData">
      <h2>RMRequisition - {{ detailsData.RequisitionNumber }}</h2>
      <p>Date: {{ detailsData.RequisitionDate | date:'dd-MMM-yyyy' }}</p>
      <p>Total Qty: {{ detailsData.TotalQty }}</p>
      <p>Total Bag: {{ detailsData.TotalBag }}</p>
      <p>Total Roll: {{ detailsData.TotalRoll }}</p>
      <p *ngIf="detailsData.Remarks">Remarks: {{ detailsData.Remarks }}</p>

      <p-table [value]="detailsData.Items" [responsive]="true">
        <ng-template pTemplate="header">
          <tr>
            <th>Article</th>
            <th>Description</th>
            <th>Quantity</th>
            <th>Roll/Bag</th>
            <th>R/B Qty</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item>
          <tr>
            <td>{{ item.ConcatArticleNo }}</td>
            <td>{{ item.Description }}</td>
            <td>{{ item.Quantity }}</td>
            <td>{{ item.Roll_Bag }}</td>
            <td>{{ item.RollBag_Quantity }}</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </p-dialog>
</div>
  </div>
  </div>

