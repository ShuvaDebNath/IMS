<div class="container m-2 p-2 shadow-sm">
  <h1 class="mb-3 theme-text fw-bold">ðŸ“¦ Finish Goods Info with Stock</h1>

  <p-table #table [value]="finishGoodsItemsWithStock" [paginator]="true" [rows]="10"
      [showCurrentPageReport]="true" [rowsPerPageOptions]="[10,20,50]"
      [globalFilterFields]="['Article_No','Color','Measurement','Unit','Packaging','GSM','Weight','StockQuantity','RollQuantity','Stock_Location_Name']"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
      class="p-datatable-sm p-datatable-striped">

      <ng-template pTemplate="caption">
        <div class="d-flex justify-content-between align-items-center">
          <button pButton type="button" icon="pi pi-filter-slash"
              label="Clear Filters"
              class="btn theme-btn-cancel btn-sm"
              (click)="table.clear()">
          </button>

          <span class="p-input-icon-left">
            <i class="pi pi-search"></i>
            <input pInputText type="text"
                (input)="table.filterGlobal($any($event.target).value, 'contains')"
                placeholder="Search finish goods..." />
          </span>
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr>
          <th class="text-center">#</th>
          <th pSortableColumn="Article_No">Article No <p-sortIcon field="Article_No"></p-sortIcon></th>
          <th pSortableColumn="Color">Color <p-sortIcon field="Color"></p-sortIcon></th>
          <th pSortableColumn="Width">Width <p-sortIcon field="Width"></p-sortIcon></th>
          <th pSortableColumn="Unit">Unit <p-sortIcon field="Unit"></p-sortIcon></th>
          <th pSortableColumn="Packaging">Packaging <p-sortIcon field="Packaging"></p-sortIcon></th>
          <th pSortableColumn="GSM">GSM <p-sortIcon field="GSM"></p-sortIcon></th>
          <th pSortableColumn="Weight">Weight <p-sortIcon field="Weight"></p-sortIcon></th>
          <th pSortableColumn="StockQuantity">Stock <p-sortIcon field="StockQuantity"></p-sortIcon></th>
          <th pSortableColumn="RollQuantity">Roll <p-sortIcon field="RollQuantity"></p-sortIcon></th>
          <th pSortableColumn="Stock_Location_Name">Location <p-sortIcon field="Stock_Location_Name"></p-sortIcon></th>
          <th class="text-center">Action</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-row let-i="rowIndex">
        <tr>
          <td class="text-center fw-bold">{{ i + 1 }}</td>
          <td>{{ row.Article_No }}</td>
          <td>{{ row.Color }}</td>
          <td>{{ row.Measurement }}</td>
          <td>{{ row.Unit }}</td>
          <td>{{ row.Packaging }}</td>
          <td>{{ row.GSM }}</td>
          <td>{{ row.Weight }}</td>
          <td>{{ row.StockQuantity }}</td>
          <td>{{ row.RollQuantity }}</td>
          <td>{{ row.Stock_Location_Name }}</td>
          <td class="text-center">
            <p-button icon="pi pi-plus" styleClass="p-button-rounded p-button-sm me-2"
                [ngClass]="'btn-stock-in'"
                (onClick)="onStockIn(row)" tooltip="Stock In"></p-button>

            <p-button icon="pi pi-minus" styleClass="p-button-rounded p-button-sm"
                [ngClass]="'btn-stock-out'"
                (onClick)="onStockOut(row)" tooltip="Stock Out"></p-button>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="12" class="text-center text-muted py-4">
            ðŸš« No finish goods found.
          </td>
        </tr>
      </ng-template>
  </p-table>

  <p-dialog header="Stock In Finish Goods" [(visible)]="isStockInVisible" [modal]="true"
      [style]="{ width: '40vw' }" [closable]="true" styleClass="p-fluid stock-in-dialog">
      <form class="row g-3">
        <div class="col-md-6">
          <label class="fw-bold small">Article No</label>
          <input class="form-control" [value]="selectedRow?.Article_No" readonly />
        </div>
        <div class="col-md-6">
          <label class="fw-bold small">Color</label>
          <input class="form-control" [value]="selectedRow?.Color" readonly />
        </div>
        <div class="col-md-6">
          <label class="fw-bold small">Width</label>
          <input class="form-control" [value]="selectedRow?.Measurement" readonly />
        </div>
        <div class="col-md-6">
          <label class="fw-bold small">Unit</label>
          <input class="form-control" [value]="selectedRow?.Unit" readonly />
        </div>
        <div class="col-md-6">
          <label class="fw-bold small">Weight</label>
          <input class="form-control" [value]="selectedRow?.Weight" readonly />
        </div>
        <div class="col-md-6">
          <label class="fw-bold small">Quantity</label>
          <input class="form-control" type="number" [(ngModel)]="stockInForm.Stock_In" name="Quantity" />
        </div>
        <div class="col-md-6">
          <label class="fw-bold small">Roll</label>
          <input class="form-control" type="number" [(ngModel)]="stockInForm.Roll_In" name="Roll" />
        </div>
        <div class="col-md-6">
          <label class="fw-bold small">Stock Location</label>
          <select class="form-select" [(ngModel)]="stockInForm.Stock_Location_ID" name="Stock_Location_ID">
            <option *ngFor="let loc of StockLocationItems" [value]="loc.Stock_Location_ID">
              {{ loc.Stock_Location_Name }}
            </option>
          </select>
        </div>
        <div class="col-12">
          <label class="fw-bold small">Note</label>
          <textarea class="form-control" rows="2" [(ngModel)]="stockInForm.Note" name="Note"></textarea>
        </div>

        <div class="d-flex justify-content-end gap-2 mt-3">
          <button type="button" class="btn btn-light border" (click)="isStockInVisible = false">âœ– Close</button>
          <button type="button" class="btn theme-btn" (click)="onSaveStockIn()">âœ” Save</button>
        </div>
      </form>
  </p-dialog>

  <p-dialog header="Stock Out Finish Goods" [(visible)]="isStockOutVisible" [modal]="true"
      [style]="{ width: '40vw' }" [closable]="true" styleClass="p-fluid stock-out-dialog">
      <form class="row g-3">
        <div class="col-md-6">
          <label class="fw-bold small">Article No</label>
          <input class="form-control" [value]="selectedRow?.Article_No" readonly />
        </div>
        <div class="col-md-6">
          <label class="fw-bold small">Color</label>
          <input class="form-control" [value]="selectedRow?.Color" readonly />
        </div>
        <div class="col-md-6">
          <label class="fw-bold small">Width</label>
          <input class="form-control" [value]="selectedRow?.Measurement" readonly />
        </div>
        <div class="col-md-6">
          <label class="fw-bold small">Unit</label>
          <input class="form-control" [value]="selectedRow?.Unit" readonly />
        </div>
        <div class="col-md-6">
          <label class="fw-bold small">Weight</label>
          <input class="form-control" [value]="selectedRow?.Weight" readonly />
        </div>
        <div class="col-md-6">
          <label class="fw-bold small">Quantity</label>
          <input class="form-control" type="number" [(ngModel)]="stockOutForm.Stock_Out" name="Quantity" />
        </div>
        <div class="col-md-6">
          <label class="fw-bold small">Roll</label>
          <input class="form-control" type="number" [(ngModel)]="stockOutForm.Roll_Out" name="Roll" />
        </div>
        <div class="col-md-6">
          <label class="fw-bold small">Location</label>
          <input class="form-control" [value]="selectedRow?.Stock_Location_Name" readonly />
        </div>
        <div class="col-12">
          <label class="fw-bold small">Note</label>
          <textarea class="form-control" rows="2" [(ngModel)]="stockOutForm.Note" name="Note"></textarea>
        </div>

        <div class="d-flex justify-content-end gap-2 mt-3">
          <button type="button" class="btn btn-light border" (click)="isStockOutVisible = false">âœ– Close</button>
          <button type="button" class="btn theme-btn" (click)="onSaveStockOut()">âœ” Save</button>
        </div>
      </form>
  </p-dialog>
</div>
