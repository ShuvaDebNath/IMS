<div class="container shadow-sm p-3 mb-5 bg-white rounded">
  <h1 class="theme-text">
    <label class="theme-text" style="font-size: 2.5rem" *ngIf="isEdit"
      >Edit</label
    ><label style="font-size: 2.5rem" class="theme-text" *ngIf="!isEdit"
      >Generate</label
    >
    Monthly Report Form
  </h1>

  <br />
  <form [formGroup]="taskForm" >
    <!-- Header fields -->
    <div class="row align-items-center">
      <div class="col-3">
        <label class="control-label" for="inlineFormInputGroup"
          >From Date</label
        >
        <input type="date" formControlName="FromDate" class="form-control" />
      </div>
      <div class="col-3">
        <label class="control-label" for="inlineFormInputGroup">To Date</label>
        <input type="date" formControlName="ToDate" class="form-control" />
      </div>
      <div class="col-3">
        <button
          title="Load Customer"
          type="button"
          (click)="loadCustomer()"
          class="btn btn-sm theme-btn mt-4 p-1"
        >
          <i class="fas fa-search"></i>&nbsp;Load Customer
        </button>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-6">
        <label class="form-label">Task No</label>
        <input
          autocomplete="off"
          type="text"
          formControlName="TaskNo"
          class="form-control"
          placeholder="Task No"
          id="taskNo"
          name="taskNo"
          [readOnly]="!isEdit"
          value=""
        />
      </div>
      <div class="col-md-6" *ngIf="isEdit">
        <label class="control-label">Date</label>

        <input type="date" formControlName="Date" class="form-control" />
      </div>
    </div>
    <div style="width: 160% !important; overflow-x: scroll">
      <!-- Items table (Monthly Report fields) -->
      <table class="table table-bordered" style="width: 160% !important">
        <thead>
          <tr>
            <th style="text-align: center">Customer Name</th>
            <th style="text-align: center">Buying Concern Factory/Buyer</th>
            <th style="text-align: center">
              Concern Factory(If buying office or group)
            </th>
            <th style="text-align: center">How many team you work</th>
            <th style="text-align: center">Order Season</th>
            <th style="text-align: center">Description</th>
            <th style="text-align: center">
              Time and purpose of first visit this month
            </th>
            <th style="text-align: center">
              Time and purpose of second visit this month
            </th>
            <th style="text-align: center">
              Time and purpose of third visit this month
            </th>
            <th style="text-align: center">Order Summary</th>
            <th style="text-align: center">CM Summary</th>
            <th style="text-align: center">Net Sales Summary</th>
            <th style="text-align: center">Summary of Submitted Sample</th>
            <th style="text-align: center">Summary of New Article Developed</th>
            <th style="width: 60px"></th>
          </tr>
        </thead>

        <tbody formArrayName="items" style="width: 160% !important">
          <tr
            *ngFor="let item of items.controls; let i = index"
            [formGroupName]="i"
          >
            <td>
              <p-dropdown
                appendTo="body"
                class="p-0 rm-dd"
                [panelStyle]="{ width: '300px' }"
                [options]="CustomerList"
                optionLabel="CustomerName"
                optionValue="Customer_ID"
                [filter]="true"
                [virtualScroll]="true"
                [itemSize]="30"
                filterBy="CustomerName"
                [showClear]="true"
                placeholder="Select Customer"
                formControlName="CustomerName"
              ></p-dropdown>
            </td>

            <td>
              <input
                class="form-control form-control-sm"
                formControlName="Buying_Concern"
              />
            </td>
            <td>
              <input
                class="form-control form-control-sm"
                formControlName="Concern_Factory"
              />
            </td>
            <td>
              <p-dropdown
                appendTo="body"
                [options]="teamOptions"
                optionLabel="label"
                optionValue="value"
                placeholder="Team"
                formControlName="TeamSize"
              ></p-dropdown>
            </td>

            <td>
              <p-dropdown
                appendTo="body"
                [options]="orderSeasons"
                optionLabel="label"
                optionValue="value"
                placeholder="Order Season"
                formControlName="OrderSeason"
              ></p-dropdown>
            </td>

            <td>
              <input
                class="form-control form-control-sm"
                formControlName="Description"
              />
            </td>

            <td>
              <input
                class="form-control form-control-sm"
                formControlName="Visit1"
              />
            </td>

            <td>
              <input
                class="form-control form-control-sm"
                formControlName="Visit2"
              />
            </td>

            <td>
              <input
                class="form-control form-control-sm"
                formControlName="Visit3"
              />
            </td>

            <td>
              <textarea
                class="form-control form-control-sm"
                formControlName="OrderSummary"
              ></textarea>
            </td>
            <td>
              <input
                class="form-control form-control-sm"
                formControlName="CM_Summary"
              />
            </td>
            <td>
              <input
                class="form-control form-control-sm"
                formControlName="Net_Sales_Summary"
              />
            </td>

            <td>
              <textarea
                class="form-control form-control-sm"
                formControlName="SampleSummary"
              ></textarea>
            </td>

            <td>
              <textarea
                class="form-control form-control-sm"
                formControlName="NewArticleSummary"
              ></textarea>
            </td>

            <td>
              <button
                type="button"
                class="btn btn-sm btn-danger"
                (click)="removeItem(i)"
              >
                Ã—
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="d-flex justify-content-end gap-2 mt-3">
      <button type="button" class="btn btn-outline-success" (click)="addItem()">
        <i class="bi bi-plus-circle me-1"></i> Add Row
      </button>

      <button
        type="submit"
        (click)="saveData()"
        [ngClass]="{
          'theme-btn-disable': taskForm.invalid,
        }"
        class="btn theme-btn btn-rounded"
        [disabled]="taskForm.invalid"
        *ngIf="!isEdit"
      >
        <i class="bi bi-save me-1"></i> Save
      </button>
      <button
        type="submit"
        (click)="UpdateData()"
        [ngClass]="{
          'theme-btn-disable': taskForm.invalid,
        }"
        class="btn theme-btn btn-rounded"
        [disabled]="taskForm.invalid"
        *ngIf="isEdit"
      >
        <i class="bi bi-save me-1"></i> Save
      </button>
    </div>
  </form>
</div>
