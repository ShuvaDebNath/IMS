<div class="container shadow-sm p-3 mb-5 bg-white rounded">
  <h1 class="theme-text">Generate Task Report Form</h1>

  <br />
  <form [formGroup]="taskForm" style="overflow: scroll">
    <!-- Header fields -->
    <div class="row mb-3">
      <div class="col-md-6">
        <label class="form-label">Task No</label>
        <input
          autocomplete="off"
          type="text"
          formControlName="TaskNo"
          class="form-control"
          placeholder="Task No"
          id="taskNo"
          name="taskNo"
          value=""
        />
      </div>
      <div class="col-md-6">
        <label class="control-label">Date</label>

        <input type="date" formControlName="Date" class="form-control" />
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-6">
        <label class="form-label">To</label>
        <input
          autocomplete="off"
          type="text"
          formControlName="ToMail"
          class="form-control"
          placeholder="To Mail"
          id="toMail"
          name="toMail"
          value=""
        />
        <div
          *ngIf="
            taskForm.get('ToMail')?.invalid &&
            (taskForm.get('ToMail')?.touched || taskForm.get('ToMail')?.dirty)
          "
          class="text-danger small mt-1"
        >
          <div *ngIf="taskForm.get('ToMail')?.hasError('required')">
            To email is required
          </div>
          <div *ngIf="taskForm.get('ToMail')?.hasError('email')">
            Please enter a valid email address
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <label class="form-label">CC</label>
        <input
          autocomplete="off"
          type="text"
          formControlName="CcMail"
          class="form-control"
          placeholder="cc Mail"
          id="ccMail"
          name="ccMail"
          value="lilya@sunshineinterlining.com"
        />
        <div
          *ngIf="
            taskForm.get('CcMail')?.invalid &&
            (taskForm.get('CcMail')?.touched || taskForm.get('CcMail')?.dirty)
          "
          class="text-danger small mt-1"
        >
          <div *ngIf="taskForm.get('CcMail')?.hasError('required')">
            Cc email is required
          </div>
          <div *ngIf="taskForm.get('CcMail')?.hasError('email')">
            Please enter a valid email address
          </div>
        </div>
      </div>
    </div>

    <!-- Items table -->
    <table class="table table-bordered" style="width: 160% !important">
      <thead>
        <tr>
          <th style="text-align: center">Buying House</th>
          <th style="text-align: center">Customer Name</th>
          <th style="text-align: center">In Time</th>
          <th style="text-align: center">Out Time</th>
          <th style="text-align: center">Old/New</th>
          <th style="text-align: center">Already Receive Order Article</th>
          <th style="text-align: center">Unit Price USD</th>
          <th style="text-align: center">Unit Price BDT</th>
          <th style="text-align: center">Prod. Cost Unit</th>
          <th style="text-align: center">First order received time</th>
          <th style="text-align: center">Latest order received time</th>
          <th style="text-align: center">Payment Issue</th>
          <th style="text-align: center">Commercial Issue</th>
          <th style="text-align: center">Sample Submit</th>
          <th style="text-align: center">Remarks</th>
          <th></th>
        </tr>
      </thead>

      <tbody formArrayName="items" style="width: 160% !important">
        <tr
          *ngFor="let item of items.controls; let i = index"
          [formGroupName]="i"
        >
          <td>
						<input class="form-control form-control-sm" formControlName="Buyer" style="width: 180px;"/>
					</td>
          <td>
            <div class="form-group">
              <p-dropdown
                appendTo="body"
                class="p-0 rm-dd"
                [panelStyle]="{ width: '300px' }"
                [options]="CustomerList"
                optionLabel="CustomerName"
                optionValue="Customer_ID"
                [filter]="true"
                filterBy="CustomerName"
                [showClear]="true"
                placeholder="Please Select"
                formControlName="CustomerName"
                [virtualScroll]="true"
                [virtualScrollItemSize]="30"
              >
                <ng-template let-article pTemplate="item">
                  <div class="flex align-items-center gap-2">
                    <div>{{ article.CustomerName }}</div>
                  </div>
                </ng-template>
              </p-dropdown>
            </div>
          </td>

          <td class="col-description">
            <p-calendar
              appendTo="body"
              inputId="calendar-24h"
              formControlName="InTime"
              [showTime]="true"
              [hourFormat]="'24'"
                [style]="{ width: '150px' }"
            />
          </td>

          <td class="col-description">
            <p-calendar
              appendTo="body"
              inputId="calendar-24h"
              formControlName="OutTime"
              [showTime]="true"
              [hourFormat]="'24'"
                [style]="{ width: '150px' }"
            />
            <div
              *ngIf="
                item.get('OutTime')?.hasError('required') &&
                item.get('OutTime')?.touched
              "
              class="text-danger small"
            >
              Out Time is required
            </div>
            <div
              *ngIf="
                item.get('OutTime')?.hasError('outBeforeIn') &&
                item.get('OutTime')?.touched
              "
              class="text-danger small"
            >
              Out Time cannot be earlier than In Time
            </div>
          </td>
          <td>
            <div class="form-group">
              <p-dropdown
                appendTo="body"
                class="p-0 rm-dd"
                [panelStyle]="{ width: '300px' }"
                [options]="type"
                optionLabel="label"
                optionValue="value"
                [filter]="true"
                filterBy="label"
                [showClear]="true"
                placeholder="Please Select"
                formControlName="Type"
                [virtualScroll]="true"
                [virtualScrollItemSize]="30"
              >
                <ng-template let-article pTemplate="item">
                  <div class="flex align-items-center gap-2">
                    <div>{{ article.label }}</div>
                  </div>
                </ng-template>
              </p-dropdown>
            </div>
          </td>

          <td>
            <input
              class="form-control form-control-sm"
              formControlName="AlreadyReceivedArticle"
              style="width: 180px;"
            />
          </td>

          <td>
            <input
              class="form-control form-control-sm"
              formControlName="UnitPriceUSD"
              style="width: 180px;"
            />
          </td>

          <td>
            <input
              class="form-control form-control-sm"
              formControlName="UnitPriceBDT"
              style="width: 180px;"
            />
          </td>

          <td>
            <input
              class="form-control form-control-sm"
              formControlName="ProdCostUnit"
              style="width: 180px;"
            />
          </td>

          <td>
            <input
              class="form-control form-control-sm"
              formControlName="FirstOrderReceivedTime"
              style="width: 180px;"
            />
          </td>

          <td>
            <input
              class="form-control form-control-sm"
              formControlName="LatestOrderReceivedTime"
              style="width: 180px;"
            />
          </td>
          <td>
            <div class="form-group">
              <p-dropdown
                appendTo="body"
                class="p-0 rm-dd"
                [panelStyle]="{ width: '300px' }"
                [options]="solveList"
                optionLabel="label"
                optionValue="value"
                [filter]="true"
                filterBy="label"
                [showClear]="true"
                placeholder="Please Select"
                formControlName="PaymentIssue"
                [virtualScroll]="true"
                [virtualScrollItemSize]="30"
              >
                <ng-template let-article pTemplate="item">
                  <div class="flex align-items-center gap-2">
                    <div>{{ article.label }}</div>
                  </div>
                </ng-template>
              </p-dropdown>
            </div>
          </td>
          <td>
            <div class="form-group">
              <p-dropdown
                appendTo="body"
                class="p-0 rm-dd"
                [panelStyle]="{ width: '300px' }"
                [options]="solveList"
                optionLabel="label"
                optionValue="value"
                [filter]="true"
                filterBy="label"
                [showClear]="true"
                placeholder="Please Select"
                formControlName="CommercialIssue"
                [virtualScroll]="true"
                [virtualScrollItemSize]="30"
              >
                <ng-template let-article pTemplate="item">
                  <div class="flex align-items-center gap-2">
                    <div>{{ article.label }}</div>
                  </div>
                </ng-template>
              </p-dropdown>
            </div>
          </td>
          <td class="col-description">
            <textarea
              class="form-control form-control-sm"
              formControlName="SampleSubmit"
              style="width: 180px;"
              required="true"
            ></textarea>
          </td>
          <td class="col-description">
            <textarea
              class="form-control form-control-sm"
              formControlName="discussion"
              style="width: 180px;"
              required="true"
            ></textarea>
          </td>
          <td>
            <button
              type="button"
              class="btn btn-sm btn-danger"
              (click)="removeItem(i)"
            >
              Ã—
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="d-flex justify-content-end gap-2 mt-3">
      <button type="button" class="btn btn-outline-success" (click)="addItem()">
        <i class="bi bi-plus-circle me-1"></i> Add Row
      </button>

      <button
        type="submit"
        (click)="saveData()"
        class="btn theme-btn btn-rounded"
        *ngIf="!isEdit"
      >
        <i class="bi bi-save me-1"></i> Save
      </button>
      <button
        type="submit"
        (click)="UpdateData()"
        [ngClass]="{
          'theme-btn-disable': taskForm.invalid
        }"
        class="btn theme-btn btn-rounded"
        [disabled]="taskForm.invalid"
        *ngIf="isEdit"
      >
        <i class="bi bi-save me-1"></i> Save
      </button>
    </div>
  </form>
</div>



